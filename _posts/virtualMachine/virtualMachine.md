---
title: virtualMachine
date: 2023-03-16 00:10:04
tags:
categories:
- virtualMachine
---

### ~起因：

希望通过vsc ssh远程连接虚拟机进行实验，但是ssh连接遇到问题。

##### 1.选择**桥接模式**还是**nat**

桥接模式需要申请额外的ip,但校园网不认可产生的新ip，无法进行联网。(之前貌似成功联网过一次，目前不太清楚怎么配置，可能和有线接入有关)

##### 2.**ssh认证，免密登录**

遇到问题:在宿舍输入密码错误，但到教室wifi则可以

猜测：网络配置后某些地方没有更新	

**免密登录：**

win上安装openssh 服务器，双方分享公匙

[win10系统的本地机和安装的Ubuntu虚拟机互相实现SSH免密码登录 (baidu.com)](https://baijiahao.baidu.com/s?id=1743379097529115071&wfr=spider&for=pc)

出现提示私匙读取权限过大：

修改.ssh权限，私匙只有持有者，即本用户具有读取权限

##### 3.实现虚拟机服务**开机自启，修改配置**sshd_config

##### 4.配置静态ip

选中net后设置子网地址和网关地址，(其中x.1需要保留，x.2可设置为网关),关闭dhcp服务，

进入虚拟机设置ip,×

dhcp设置范围为想要的那个ip√ (偷个懒，目前用不到那么多ip，后续需要再加)



#### ~桥接模式

主机与虚拟机需要在一个网段，更换后若虚拟机ip不对需要到虚拟机设置中重置ip

#### ~vsc通过ssh连接虚拟机

（自己在桥接模式下实现）

1.虚拟机上安装ssh server

2.开启ssh服务(设为开机启动)

3.(关闭主机，虚拟机防火墙)

4.主机vsc安装ssh插件

vsc配置ssh信息：

(可能需要再扩展设置中手动配置ssh.exe地址，C:\Windows\System32\OpenSSH\ssh.exe)

(可能需要在扩展设置中配置虚拟机ip)

ip即虚拟机ip, hostname一般也为ip, user 用户

5.连接(需要root密码？)

6.安装扩展，主机的扩展好像不能给虚拟机用,需要在虚拟机再安装一份

#### ~主动获取IP

dhclient -r eth0 断开网络

dhclient -v 重新获取IP地址



以下为尝试桥接模式过程，为碰壁过程

---



#### ~3.16桥接模式下无法联网

之前莫名配置好了一次，虚拟机可以联网，可以通过主机vsc ssh访问

重启后莫名失效，无法ssh访问，虚拟机无法联网

可能原因，校园网下采用桥接模式造成的无法联网

##### 桥接模式

桥接模式就是将主机网卡与虚拟机虚拟的网卡利用虚拟网桥进行通信。在桥接的作用下，类似于把物理主机虚拟为一个交换机，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。在桥接模式下，**虚拟机ip地址需要与主机在同一个网段**，如果需要联网，则网关与DNS需要与主机网卡一致。

可能因为虚拟机需要获取一个独立ip，在分配ip时因为校园网认证的问题出现故障

在桥接模式下勾选**复制主机网络连接状态**

进入虚拟机重新主动获取ip



